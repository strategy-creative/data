<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Christchurch B2B Market Analysis Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @layer base {
            :root {
                --chart-1: oklch(0.646 0.222 41.116);
                --chart-2: oklch(0.6 0.118 184.704);
                --chart-3: oklch(0.398 0.07 227.392);
                --chart-4: oklch(0.828 0.189 84.429);
                --chart-5: oklch(0.769 0.188 70.08);
            }
        }
        
        .card {
            @apply bg-white rounded-lg shadow-md border border-gray-200 p-6;
        }
        .metric-card {
            @apply bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-lg p-6 text-center;
        }
        .metric-value {
            @apply text-3xl font-bold text-blue-600 mb-2;
        }
        .metric-label {
            @apply text-sm text-blue-800 uppercase tracking-wide;
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        .citation {
            @apply text-xs text-gray-500 mt-2;
        }
        .source-link {
            @apply text-blue-600 hover:text-blue-800 underline;
        }
        .table-container {
            @apply overflow-x-auto rounded-lg border border-gray-200;
        }
        .table {
            @apply min-w-full divide-y divide-gray-200;
        }
        .table-header {
            @apply bg-gray-50;
        }
        .table-header-cell {
            @apply px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider;
        }
        .table-body {
            @apply bg-white divide-y divide-gray-200;
        }
        .table-row {
            @apply hover:bg-gray-50;
        }
        .table-cell {
            @apply px-6 py-4 whitespace-nowrap text-sm;
        }
        .table-cell-primary {
            @apply font-medium text-gray-900;
        }
        .table-cell-secondary {
            @apply text-gray-500;
        }
        .insight-card {
            @apply p-4 rounded-lg border;
        }
        .insight-card-blue {
            @apply bg-blue-50 border-blue-200;
        }
        .insight-card-green {
            @apply bg-green-50 border-green-200;
        }
        .insight-card-purple {
            @apply bg-purple-50 border-purple-200;
        }
        .insight-title {
            @apply font-semibold mb-2;
        }
        .insight-text {
            @apply text-sm;
        }
        .insight-title-blue {
            @apply text-blue-900;
        }
        .insight-title-green {
            @apply text-green-900;
        }
        .insight-title-purple {
            @apply text-purple-900;
        }
        .insight-text-blue {
            @apply text-blue-700;
        }
        .insight-text-green {
            @apply text-green-700;
        }
        .insight-text-purple {
            @apply text-purple-700;
        }
        .sources-section {
            @apply bg-gray-50 rounded-lg p-6 mt-8;
        }
        .source-item {
            @apply text-sm text-gray-600 mb-2;
        }
        .source-number {
            @apply font-mono text-gray-500;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 py-6">
            <h1 class="text-3xl font-bold text-gray-900">Christchurch B2B Market Analysis</h1>
            <p class="text-gray-600 mt-2">Printer/Photocopier Leasing Market Dashboard</p>
            <p class="text-sm text-gray-500 mt-1">Data Sources: IBISWorld, Figure.NZ, Government Procurement, Industry Reports (2024-2025)</p>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- Key Metrics -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="metric-card">
                <div class="metric-value">NZD $133.6M</div>
                <div class="metric-label">Total Addressable Market</div>
                <div class="citation">Source: IBISWorld [12][16][17]</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">NZD $60.1M</div>
                <div class="metric-label">Current Market Size</div>
                <div class="citation">Source: IBISWorld [17][18][16]</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">NZD $73.5M</div>
                <div class="metric-label">Growth Potential</div>
                <div class="citation">Source: IBISWorld [17][18][16]</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">45%</div>
                <div class="metric-label">Market Penetration</div>
                <div class="citation">Source: Industry Reports [17][18][16]</div>
            </div>
        </div>

        <!-- Charts Row 1 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Market Penetration Pie Chart -->
            <div class="card">
                <h3 class="text-xl font-semibold text-gray-900 mb-4">Market Penetration</h3>
                <div class="chart-container">
                    <canvas id="penetrationChart"></canvas>
                </div>
                <div class="citation">
                    Data Source: IBISWorld Market Research [12][16][17] | 
                    <a href="https://www.ibisworld.com/new-zealand/industry/printing/166/" class="source-link" target="_blank">View Source</a>
                </div>
            </div>

            <!-- Business Segments Bar Chart -->
            <div class="card">
                <h3 class="text-xl font-semibold text-gray-900 mb-4">Market Share by Business Segment</h3>
                <div class="chart-container">
                    <canvas id="segmentsChart"></canvas>
                </div>
                <div class="citation">
                    Data Source: Figure.NZ Business Demographics [18] | 
                    <a href="https://figure.nz/chart/ahwIqAsrrOUSfxB7-E2zPuowIznzkFOWM" class="source-link" target="_blank">View Source</a>
                </div>
            </div>
        </div>

        <!-- Charts Row 2 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Revenue Distribution -->
            <div class="card">
                <h3 class="text-xl font-semibold text-gray-900 mb-4">Revenue by Segment (NZD $M)</h3>
                <div class="chart-container">
                    <canvas id="revenueChart"></canvas>
                </div>
                <div class="citation">
                    Data Source: IBISWorld & Industry Analysis [16][18] | 
                    <a href="https://www.ibisworld.com/new-zealand/market-size/printing/166/" class="source-link" target="_blank">View Source</a>
                </div>
            </div>

            <!-- Entity Count vs Revenue Efficiency -->
            <div class="card">
                <h3 class="text-xl font-semibold text-gray-900 mb-4">Entity Count vs Revenue per Entity</h3>
                <div class="chart-container">
                    <canvas id="efficiencyChart"></canvas>
                </div>
                <div class="citation">
                    Data Source: Figure.NZ & Industry Reports [18][13][14] | 
                    <a href="https://figure.nz/chart/ahwIqAsrrOUSfxB7-E2zPuowIznzkFOWM" class="source-link" target="_blank">View Source</a>
                </div>
            </div>
        </div>

        <!-- Strategic Insights -->
        <div class="card mb-8">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">Strategic Insights</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="insight-card insight-card-blue">
                    <h4 class="insight-title insight-title-blue">Volume Play Strategy</h4>
                    <p class="insight-text insight-text-blue">Target zero and 1-5 employee segments for market share growth</p>
                    <div class="citation">Based on 73% of businesses having 0-5 employees [18]</div>
                </div>
                <div class="insight-card insight-card-green">
                    <h4 class="insight-title insight-title-green">Value Play Strategy</h4>
                    <p class="insight-text insight-text-green">Focus on 6-19 and 50+ employee segments for revenue maximization</p>
                    <div class="citation">Higher per-entity spend: $6K-$35K vs $800-$2.5K [13][14]</div>
                </div>
                <div class="insight-card insight-card-purple">
                    <h4 class="insight-title insight-title-purple">Specialization</h4>
                    <p class="insight-text insight-text-purple">Government & Education sector offers stable, contract-based opportunities</p>
                    <div class="citation">PTAS panel procurement required [11][19][20]</div>
                </div>
            </div>
        </div>

        <!-- Detailed Data Table -->
        <div class="card">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">Detailed Segment Analysis</h3>
            <div class="table-container">
                <table class="table">
                    <thead class="table-header">
                        <tr>
                            <th class="table-header-cell">Segment</th>
                            <th class="table-header-cell">Market Share</th>
                            <th class="table-header-cell">Revenue (NZD $M)</th>
                            <th class="table-header-cell">Entities</th>
                            <th class="table-header-cell">Per Entity (NZD $)</th>
                            <th class="table-header-cell">Data Source</th>
                        </tr>
                    </thead>
                    <tbody class="table-body">
                        <tr class="table-row">
                            <td class="table-cell table-cell-primary">Zero employees</td>
                            <td class="table-cell table-cell-secondary">27.3%</td>
                            <td class="table-cell table-cell-secondary">$36.5M</td>
                            <td class="table-cell table-cell-secondary">45,601</td>
                            <td class="table-cell table-cell-secondary">$800</td>
                            <td class="table-cell table-cell-secondary">[18][16]</td>
                        </tr>
                        <tr class="table-row">
                            <td class="table-cell table-cell-primary">1-5 employees</td>
                            <td class="table-cell table-cell-secondary">19.9%</td>
                            <td class="table-cell table-cell-secondary">$26.6M</td>
                            <td class="table-cell table-cell-secondary">18,200</td>
                            <td class="table-cell table-cell-secondary">$1,462</td>
                            <td class="table-cell table-cell-secondary">[18][16]</td>
                        </tr>
                        <tr class="table-row">
                            <td class="table-cell table-cell-primary">6-19 employees</td>
                            <td class="table-cell table-cell-secondary">19.6%</td>
                            <td class="table-cell table-cell-secondary">$26.2M</td>
                            <td class="table-cell table-cell-secondary">17,900</td>
                            <td class="table-cell table-cell-secondary">$1,464</td>
                            <td class="table-cell table-cell-secondary">[16][18]</td>
                        </tr>
                        <tr class="table-row">
                            <td class="table-cell table-cell-primary">50+ employees</td>
                            <td class="table-cell table-cell-secondary">16.4%</td>
                            <td class="table-cell table-cell-secondary">$21.9M</td>
                            <td class="table-cell table-cell-secondary">625</td>
                            <td class="table-cell table-cell-secondary">$35,000</td>
                            <td class="table-cell table-cell-secondary">[16][18]</td>
                        </tr>
                        <tr class="table-row">
                            <td class="table-cell table-cell-primary">20-49 employees</td>
                            <td class="table-cell table-cell-secondary">14.0%</td>
                            <td class="table-cell table-cell-secondary">$18.7M</td>
                            <td class="table-cell table-cell-secondary">12,800</td>
                            <td class="table-cell table-cell-secondary">$1,461</td>
                            <td class="table-cell table-cell-secondary">[18][16]</td>
                        </tr>
                        <tr class="table-row">
                            <td class="table-cell table-cell-primary">Government & Education</td>
                            <td class="table-cell table-cell-secondary">2.8%</td>
                            <td class="table-cell table-cell-secondary">$3.8M</td>
                            <td class="table-cell table-cell-secondary">2,560</td>
                            <td class="table-cell table-cell-secondary">$1,484</td>
                            <td class="table-cell table-cell-secondary">[11][19]</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Market Trends Section -->
        <div class="card mb-8">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">Market Trends & Insights</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                    <h4 class="font-semibold text-yellow-900 mb-2">Industry Context</h4>
                    <p class="text-sm text-yellow-700 mb-2">NZ printing industry valued at $1.4 billion (2025), declining 2.2% p.a. due to digitization</p>
                    <div class="citation">Source: IBISWorld [12] | <a href="https://www.ibisworld.com/new-zealand/industry/printing/166/" class="source-link" target="_blank">View Source</a></div>
                </div>
                <div class="p-4 bg-indigo-50 rounded-lg border border-indigo-200">
                    <h4 class="font-semibold text-indigo-900 mb-2">Leasing Penetration</h4>
                    <p class="text-sm text-indigo-700 mb-2">67-80% of B2B office equipment transactions now occur on lease or managed print agreements</p>
                    <div class="citation">Source: Industry Reports [15][13][14] | <a href="https://www.ricoh.co.nz/industries/ricoh-financial-services" class="source-link" target="_blank">View Source</a></div>
                </div>
            </div>
        </div>

        <!-- Sources Section -->
        <div class="sources-section">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">Data Sources & Citations</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h4 class="font-semibold text-gray-900 mb-3">Primary Market Data</h4>
                    <div class="source-item">
                        <span class="source-number">[12]</span> IBISWorld, "Printing in New Zealand – Market Size Statistics," 2025-06-07
                        <a href="https://www.ibisworld.com/new-zealand/industry/printing/166/" class="source-link" target="_blank">View</a>
                    </div>
                    <div class="source-item">
                        <span class="source-number">[16]</span> IBISWorld, "Printing in New Zealand – Market Research Report (2015-2030)," 2025-07-10
                        <a href="https://www.ibisworld.com/new-zealand/market-size/printing/166/" class="source-link" target="_blank">View</a>
                    </div>
                    <div class="source-item">
                        <span class="source-number">[17]</span> IBISWorld, "Furniture, Appliance and Equipment Rental in New Zealand," 2025-07-06
                        <a href="https://www.ibisworld.com/new-zealand/industry/furniture-appliance-and-equipment-rental/670/" class="source-link" target="_blank">View</a>
                    </div>
                    <div class="source-item">
                        <span class="source-number">[18]</span> Figure.NZ, "Businesses in Christchurch City, New Zealand," 2024-10-30
                        <a href="https://figure.nz/chart/ahwIqAsrrOUSfxB7-E2zPuowIznzkFOWM" class="source-link" target="_blank">View</a>
                    </div>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-900 mb-3">Industry & Government Sources</h4>
                    <div class="source-item">
                        <span class="source-number">[11]</span> New Zealand Government Procurement, "Print technology and associated services," 2023-08-30
                        <a href="https://www.procurement.govt.nz/contracts/print-technology-and-associated-services/" class="source-link" target="_blank">View</a>
                    </div>
                    <div class="source-item">
                        <span class="source-number">[13]</span> BDL Copiers, "Should I Lease or Buy Business Printers?" 2024-06-25
                        <a href="https://bdlcopiers.co.nz/lease-or-buy/" class="source-link" target="_blank">View</a>
                    </div>
                    <div class="source-item">
                        <span class="source-number">[14]</span> Canon New Zealand, "Purchasing A Printer For Your Business," 2022-01-12
                        <a href="https://www.canon.co.nz/business/purchasing-a-printer-for-your-business" class="source-link" target="_blank">View</a>
                    </div>
                    <div class="source-item">
                        <span class="source-number">[19]</span> Ricoh New Zealand, "Partner for Print in Government," 2025-06-19
                        <a href="https://www.ricoh.co.nz/industries/education" class="source-link" target="_blank">View</a>
                    </div>
                </div>
            </div>
            <div class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                <p class="text-sm text-blue-800">
                    <strong>Note:</strong> All data represents 2024-2025 estimates based on the latest available industry reports, 
                    government statistics, and market research. Market penetration figures are derived from industry analysis 
                    and may vary based on specific market conditions and timing.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Wait for DOM to be fully loaded before initializing charts
        document.addEventListener('DOMContentLoaded', function() {
            // Market data with updated figures from sources.md
            const marketData = {
                segments: ['Zero employees', '1-5 employees', '6-19 employees', '50+ employees', '20-49 employees', 'Government & Education'],
                marketShare: [27.3, 19.9, 19.6, 16.4, 14.0, 2.8],
                revenue: [36.5, 26.6, 26.2, 21.9, 18.7, 3.8],
                entities: [45601, 18200, 17900, 625, 12800, 2560],
                perEntity: [800, 1462, 1464, 35000, 1461, 1484]
            };

            // Chart colors using Shadcn chart color variables
            const colors = ['hsl(var(--chart-1))', 'hsl(var(--chart-2))', 'hsl(var(--chart-3))', 'hsl(var(--chart-4))', 'hsl(var(--chart-5))', '#06B6D4'];

            // Helper function to safely create charts
            function createChart(canvasId, chartConfig) {
                const canvas = document.getElementById(canvasId);
                if (!canvas) {
                    console.warn(`Canvas element with id '${canvasId}' not found`);
                    return null;
                }
                
                try {
                    return new Chart(canvas, chartConfig);
                } catch (error) {
                    console.error(`Error creating chart for ${canvasId}:`, error);
                    return null;
                }
            }

            // Market Penetration Pie Chart
            createChart('penetrationChart', {
                type: 'doughnut',
                data: {
                    labels: ['Current Market (45%)', 'Untapped Market (55%)'],
                    datasets: [{
                        data: [60.1, 73.5],
                        backgroundColor: ['hsl(var(--chart-1))', '#E5E7EB'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': NZD $' + context.parsed + 'M';
                                }
                            }
                        }
                    }
                }
            });

            // Business Segments Bar Chart
            createChart('segmentsChart', {
                type: 'bar',
                data: {
                    labels: marketData.segments,
                    datasets: [{
                        label: 'Market Share (%)',
                        data: marketData.marketShare,
                        backgroundColor: colors,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Market Share (%)'
                            }
                        }
                    }
                }
            });

            // Revenue Chart
            createChart('revenueChart', {
                type: 'bar',
                data: {
                    labels: marketData.segments,
                    datasets: [{
                        label: 'Revenue (NZD $M)',
                        data: marketData.revenue,
                        backgroundColor: colors,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Revenue (NZD $M)'
                            }
                        }
                    }
                }
            });

            // Efficiency Chart (Dual Y-axis)
            createChart('efficiencyChart', {
                type: 'line',
                data: {
                    labels: marketData.segments,
                    datasets: [
                        {
                            label: 'Number of Entities',
                            data: marketData.entities,
                            yAxisID: 'y',
                            borderColor: 'hsl(var(--chart-1))',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            fill: true
                        },
                        {
                            label: 'Revenue per Entity (NZD $)',
                            data: marketData.perEntity,
                            yAxisID: 'y1',
                            borderColor: 'hsl(var(--chart-2))',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Business Segments'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Number of Entities'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Revenue per Entity (NZD $)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        });

        // Add error handling for any potential MutationObserver issues
        window.addEventListener('error', function(event) {
            if (event.error && event.error.message && event.error.message.includes('MutationObserver')) {
                console.warn('MutationObserver error detected and handled');
                event.preventDefault();
            }
        });
    </script>
</body>
</html>